name: Notify Me

on:
  workflow_run:
    workflows: ["Update GitHub Repos JSON"]
    types:
      - completed

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram notification
        run: |
          TITLE="üîî *${{ github.repository }}*"
          COMMIT_MSG="${{ github.event.workflow_run.head_commit.message }}"
          AUTHOR="${{ github.event.workflow_run.head_commit.author.name }}"
          COMMIT_URL="${{ github.server_url }}/${{ github.repository }}/commit/${{ github.event.workflow_run.head_commit.id }}"
          WORKFLOW="${{ github.event.workflow_run.name }}"
          STATUS=""
          if [ "${{ github.event.workflow_run.conclusion }}" = "success" ]; then
            STATUS="‚úÖ *Workflow:* ${WORKFLOW} _succeeded_"
          else
            STATUS="‚ùé *Workflow:* ${WORKFLOW} _failed_"
          fi
          MSG="${TITLE}\n*Commit:* [${COMMIT_MSG}](${COMMIT_URL})\n*Author:* ${AUTHOR}\n${STATUS}"
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d parse_mode=Markdown \
            -d text="${MSG}"
